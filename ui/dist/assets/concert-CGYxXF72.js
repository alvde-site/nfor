import{k as e,r as n,I as z,O as x,o as p,Q as B,L as D,$ as S,V as N,S as F,W as H}from"./index-BCJRzhr4.js";import{C as G}from"./config-global-Cqss7OMM.js";import{d as h}from"./dayjs.min-C29_w2vz.js";import{r as J,d as _,L as Q,C as V,u as q,t as K,c as U,e as X}from"./Collapse-Df1iNIs3.js";import{T as b,a as l,d as R,b as T,e as L,c as Z,f as ee}from"./TableRow-H11z4qGd.js";import{L as se}from"./label-BEyzilVm.js";import{I as P,L as ae,P as ne,M as te}from"./flag-icon-BswvOemL.js";import{m as k,M as I}from"./LastPage-DpjcDw_Y.js";import{C as re}from"./listItemTextClasses-Do201hj2.js";import"./Select-Cp_ua5IC.js";function le({emptyRows:s,height:t,sx:o,...i}){return s?e.jsx(b,{sx:{...t&&{height:t*s},...o},...i,children:e.jsx(l,{colSpan:4})}):null}function oe({row:s}){const[t,o]=n.useState(null),[i,c]=n.useState(!1),m=n.useCallback(()=>{o(null)},[]),g=J(s.emplDet);return e.jsxs(e.Fragment,{children:[e.jsxs(b,{hover:!0,tabIndex:-1,children:[e.jsx(l,{sx:{minWidth:38,flexShrink:0,color:"text.disabled",typography:"caption",textAlign:"center"},children:e.jsx(z,{"aria-label":"expand row",size:"small",onClick:()=>c(!i),children:i?e.jsx(P,{width:22,icon:"simple-line-icons:arrow-up"}):e.jsx(P,{width:22,icon:"simple-line-icons:arrow-down"})})}),e.jsx(l,{component:"th",scope:"row",children:e.jsx(x,{gap:2,display:"flex",alignItems:"center",children:_(s.concertDate)})}),e.jsx(l,{children:e.jsx(Q,{primary:s.title,secondary:s.description,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{mt:.5,noWrap:!0,component:"span"},sx:{flex:"1 0 auto"}})}),e.jsx(l,{children:e.jsx(x,{sx:{flexShrink:0,color:"text.disabled",typography:"caption"},children:e.jsx(se,{color:s.approved&&"success"||"error",children:s.approved?"Утверждено":"Прогноз"})})})]}),e.jsx(b,{sx:{background:"var(--palette-action-hover)"},children:e.jsx(l,{colSpan:4,sx:{padding:`${i?"16px":"0"}`},children:e.jsx(V,{in:i,children:e.jsxs(x,{children:[s.concertDate.length&&e.jsxs(x,{sx:{mb:2},children:[e.jsx(p,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Даты концертов:"}),e.jsx(p,{variant:"body1",sx:{padding:"0 0 0 120px"},children:Array.isArray(s.concertDate)&&s.concertDate.map(d=>h(d).format("D.MM.YYYY")).join(", ")})]}),s.rehearsalDate.length&&h(s.rehearsalDate[0]).isValid()&&e.jsxs(x,{sx:{mb:2},children:[e.jsx(p,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Даты репетиций:"}),e.jsx(p,{variant:"body1",sx:{padding:"0 0 0 120px"},children:Array.isArray(s.rehearsalDate)&&s.rehearsalDate.map(d=>h(d).format("D.MM.YYYY")).join(", ")})]}),s.comments!=="null"&&e.jsxs(x,{sx:{mb:2},children:[e.jsx(p,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Комментарий:"}),e.jsx(p,{variant:"body1",sx:{padding:"0 0 0 120px"},children:s.comments})]}),g.length&&e.jsxs(x,{sx:{mb:2},children:[e.jsx(p,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Количество вызовов:"}),e.jsxs(R,{"aria-label":"Занятость",size:"small",sx:{"& th, & td":{background:`${B("var(--palette-info-lighterChannel)",.3)}`}},children:[e.jsx(T,{children:e.jsx(b,{children:g[0].map((d,j)=>e.jsx(l,{children:d},j))})}),e.jsx(L,{children:g.slice(1).map((d,j)=>e.jsxs(b,{children:[e.jsx(l,{component:"th",children:d[0]}),d.slice(1).map((f,y)=>e.jsx(l,{children:f},y))]},j))})]})]}),!(s.details==="null"&&s.notes==="null")&&e.jsxs(x,{sx:{mb:2},children:[e.jsx(p,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Дополнительные ссылки:"}),e.jsxs(ae,{sx:{padding:"0 0 0 120px"},children:[s.details!=="null"&&e.jsx(D,{children:e.jsx(S,{href:s.details,target:"_blank",children:"О концерте"})}),s.notes!=="null"&&e.jsx(D,{children:e.jsx(S,{href:s.notes,target:"_blank",children:"Нотный материал"})})]})]})]})})})}),e.jsx(ne,{open:!!t,anchorEl:t,onClose:m,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(te,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${k.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${k.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(I,{onClick:m,children:[e.jsx(P,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(I,{onClick:m,sx:{color:"error.main"},children:[e.jsx(P,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}function ie({headLabel:s}){return e.jsx(T,{children:e.jsxs(b,{children:[e.jsx(l,{}),s.map(t=>e.jsx(l,{align:t.align||"left",sx:{width:t.width,minWidth:t.minWidth},children:t.label},t.id))]})})}h.extend(q);h.extend(K);function ce(){const s=de(),t=JSON.parse(localStorage.getItem("initData")),o=t.length-1,i=U(t.slice(1));return e.jsxs(N,{children:[e.jsx(x,{display:"flex",alignItems:"center",mb:5,children:e.jsx(p,{variant:"h4",flexGrow:1,children:"Концерты"})}),e.jsxs(re,{children:[e.jsx(F,{children:e.jsx(Z,{sx:{overflow:"unset"},children:e.jsxs(R,{sx:{minWidth:800},children:[e.jsx(ie,{headLabel:[{id:"date",label:"Дата"},{id:"name",label:"Название"},{id:"status",label:"Статус"}]}),e.jsxs(L,{children:[i.slice(1).slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(c=>e.jsx(oe,{row:c},c.id)),e.jsx(le,{height:92,emptyRows:X(s.page,s.rowsPerPage,o-1)})]})]})})}),e.jsx(ee,{component:"div",page:s.page,count:o-1,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage,labelDisplayedRows:s.defaultLabelDisplayedRows,labelRowsPerPage:"Строк на стр.:"})]})]})}function de(){const[s,t]=n.useState("name"),[o,i]=n.useState(5),[c,m]=n.useState([]),[g,d]=n.useState("asc"),j=JSON.parse(localStorage.getItem("initData")),f=j.length-1,y=n.useCallback(()=>{const a=j.map((r,u)=>u?h(r[2][r[2].length-1]):h(0)).slice(1).reverse().findIndex(r=>h().startOf("day")>=r);return Math.floor((f-2-a)/o)},[j,f,o]),[w,C]=n.useState(y),O=n.useCallback(a=>{d(s===a&&g==="asc"?"desc":"asc"),t(a)},[g,s]),$=n.useCallback((a,r)=>{if(a){m(r);return}m([])},[]),A=n.useCallback(a=>{const r=c.includes(a)?c.filter(u=>u!==a):[...c,a];m(r)},[c]),v=n.useCallback(()=>{C(0)},[]),M=n.useCallback((a,r)=>{C(r)},[]),Y=n.useCallback(a=>{C(a)},[]),E=n.useCallback(({from:a,to:r,count:u})=>`${a}–${r} из ${u!==-1?u:`more than ${r}`}`,[]),W=n.useCallback(a=>{i(parseInt(a.target.value,10)),v()},[v]);return{page:w,order:g,onSort:O,orderBy:s,selected:c,rowsPerPage:o,onSelectRow:A,onResetPage:v,onChangePage:M,onSelectAllRows:$,onChangeRowsPerPage:W,defaultLabelDisplayedRows:E,onSetDefaultPage:Y}}function ye(){return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs("title",{children:[" ",`Концерты - ${G.appName}`]})}),e.jsx(ce,{})]})}export{ye as default};
