import{j as e,r as a,I as z,B as p,d as H,T as h,b as m,v as F,O as k,L as S,c as G,t as N,D as _,S as q,H as J}from"./index-CBTv-H4S.js";import{C as K}from"./config-global-Cqss7OMM.js";import{T as u,a as c,d as I,b as L,e as w,c as Q,f as U}from"./TableRow-C6FT2Irj.js";import{L as V}from"./label-BMBWXTyy.js";import{I as C}from"./flag-icon-CFt5iwA4.js";import{r as X,L as Z,C as ee,e as se,c as ne}from"./Collapse-BGal7Tub.js";import{L as ae,P as te,M as re}from"./Popover-CwuyrWVN.js";import{m as T,M as R}from"./LastPage-Aw0SYlz9.js";import{C as le}from"./Card-DrqGw9rs.js";import"./Select-BQZzSMZn.js";import"./users-CX3G6kN4.js";import"./listItemTextClasses-CqcliqGv.js";function oe({emptyRows:s,height:n,sx:d,...r}){return s?e.jsx(u,{sx:{...n&&{height:n*s},...d},...r,children:e.jsx(c,{colSpan:4})}):null}function ie({row:s}){const[n,d]=a.useState(null),[r,g]=a.useState(!1),o=a.useCallback(()=>{d(null)},[]),j=X(s.emplDet);return e.jsxs(e.Fragment,{children:[e.jsxs(u,{hover:!0,tabIndex:-1,children:[e.jsx(c,{sx:{minWidth:38,flexShrink:0,color:"text.disabled",typography:"caption",textAlign:"center"},children:e.jsx(z,{"aria-label":"expand row",size:"small",onClick:()=>g(!r),children:r?e.jsx(C,{width:22,icon:"simple-line-icons:arrow-up"}):e.jsx(C,{width:22,icon:"simple-line-icons:arrow-down"})})}),e.jsx(c,{component:"th",scope:"row",children:e.jsx(p,{gap:2,display:"flex",alignItems:"center",children:H(s.concertDate)})}),e.jsx(c,{children:e.jsx(Z,{primary:s.title,secondary:s.description,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{mt:.5,noWrap:!0,component:"span"},sx:{flex:"1 0 auto"}})}),e.jsx(c,{children:e.jsx(p,{sx:{flexShrink:0,color:"text.disabled",typography:"caption"},children:e.jsx(V,{color:s.approved&&"success"||"error",children:s.approved?"Утверждено":"Прогноз"})})})]}),e.jsx(u,{sx:{background:"var(--palette-action-hover)"},children:e.jsx(c,{colSpan:4,sx:{padding:`${r?"16px":"0"}`},children:e.jsx(ee,{in:r,children:e.jsxs(p,{children:[s.concertDate.length&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Даты концертов:"}),e.jsx(h,{variant:"body1",sx:{padding:"0 0 0 120px"},children:Array.isArray(s.concertDate)&&s.concertDate.map(l=>m(l).format("D.MM.YYYY")).join(", ")})]}),s.rehearsalDate.length&&m(s.rehearsalDate[0]).isValid()&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Даты репетиций:"}),e.jsx(h,{variant:"body1",sx:{padding:"0 0 0 120px"},children:Array.isArray(s.rehearsalDate)&&s.rehearsalDate.map(l=>m(l).format("D.MM.YYYY")).join(", ")})]}),s.comments!=="null"&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Комментарий:"}),e.jsx(h,{variant:"body1",sx:{padding:"0 0 0 120px"},children:s.comments})]}),j.length&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Количество вызовов:"}),e.jsxs(I,{"aria-label":"Занятость",size:"small",sx:{"& th, & td":{background:`${F("var(--palette-info-lighterChannel)",.3)}`}},children:[e.jsx(L,{children:e.jsx(u,{children:j[0].map((l,b)=>e.jsx(c,{children:l},b))})}),e.jsx(w,{children:j.slice(1).map((l,b)=>e.jsxs(u,{children:[e.jsx(c,{component:"th",children:l[0]}),l.slice(1).map((P,f)=>e.jsx(c,{children:P},f))]},b))})]})]}),!(s.details==="null"&&s.notes==="null")&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Дополнительные ссылки:"}),e.jsxs(ae,{sx:{padding:"0 0 0 120px"},children:[s.details!=="null"&&e.jsx(k,{children:e.jsx(S,{href:s.details,target:"_blank",children:"О концерте"})}),s.notes!=="null"&&e.jsx(k,{children:e.jsx(S,{href:s.notes,target:"_blank",children:"Нотный материал"})})]})]})]})})})}),e.jsx(te,{open:!!n,anchorEl:n,onClose:o,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(re,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${T.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${T.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(R,{onClick:o,children:[e.jsx(C,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(R,{onClick:o,sx:{color:"error.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}function ce({headLabel:s}){return e.jsx(L,{children:e.jsxs(u,{children:[e.jsx(c,{}),s.map(n=>e.jsx(c,{align:n.align||"left",sx:{width:n.width,minWidth:n.minWidth},children:n.label},n.id))]})})}m.extend(G);m.extend(N);function de({formattedData:s}){const n=xe({formattedData:s}),[d,r]=a.useState([]);return a.useEffect(()=>{function g(){if(s.length){const o=ne(s);r(o)}}g()},[s]),e.jsxs(_,{children:[e.jsx(p,{display:"flex",alignItems:"center",mb:5,children:e.jsx(h,{variant:"h4",flexGrow:1,children:"Концерты"})}),e.jsxs(le,{children:[e.jsx(q,{children:e.jsx(Q,{sx:{overflow:"unset"},children:e.jsxs(I,{sx:{minWidth:800},children:[e.jsx(ce,{headLabel:[{id:"date",label:"Дата"},{id:"name",label:"Название"},{id:"status",label:"Статус"}]}),e.jsxs(w,{children:[d.slice(1).slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(g=>e.jsx(ie,{row:g},g.id)),e.jsx(oe,{height:92,emptyRows:se(n.page,n.rowsPerPage,d.length-1)})]})]})})}),e.jsx(U,{component:"div",page:n.page,count:d.length-1,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,rowsPerPageOptions:[5,10,25,50,100],onRowsPerPageChange:n.onChangeRowsPerPage,labelDisplayedRows:n.defaultLabelDisplayedRows,labelRowsPerPage:"Строк на стр.:"})]})]})}function xe({formattedData:s}){const[n,d]=a.useState("name"),[r,g]=a.useState(5),[o,j]=a.useState([]),[l,b]=a.useState("asc"),P=s.length-1,f=a.useCallback(()=>{const t=s.map((x,W)=>W?m(x[2][x[2].length-1]):m(0)).slice(1).reverse().findIndex(x=>m().startOf("day")>=x),i=Math.floor((P-1-t)/r);return i>=0?i:0},[s,P,r]),[O,y]=a.useState(f),A=a.useCallback(t=>{b(n===t&&l==="asc"?"desc":"asc"),d(t)},[l,n]),E=a.useCallback((t,i)=>{if(t){j(i);return}j([])},[]),M=a.useCallback(t=>{const i=o.includes(t)?o.filter(x=>x!==t):[...o,t];j(i)},[o]),v=a.useCallback(()=>{y(0)},[]),Y=a.useCallback((t,i)=>{y(i)},[]),D=a.useCallback(()=>{const t=f();y(t)},[f]),$=a.useCallback(({from:t,to:i,count:x})=>x!==-1?`${t}–${i} из ${x}`:"Концертов нет",[]),B=a.useCallback(t=>{g(parseInt(t.target.value,10)),v()},[v]);return a.useEffect(()=>{D()},[D,r]),{page:O,order:l,onSort:A,orderBy:n,selected:o,rowsPerPage:r,onSelectRow:M,onResetPage:v,onChangePage:Y,onSelectAllRows:E,onChangeRowsPerPage:B,defaultLabelDisplayedRows:$,onSetDefaultPage:D}}function De({data:s}){return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("title",{children:[" ",`Концерты - ${K.appName}`]})}),e.jsx(de,{formattedData:s})]})}export{De as default};
