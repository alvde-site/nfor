import{j as e,r as a,I as F,B as d,d as G,T as h,b as m,v as N,Q as S,x as L,c as _,t as Q,D as q,S as J,L as K,H as U}from"./index-vp6a_yIW.js";import{C as V}from"./config-global-Cqss7OMM.js";import{T as b,a as c,d as R,b as w,e as A,c as X,f as Z}from"./TableRow-DzKJwGmJ.js";import{L as ee}from"./label-3OW2WnRx.js";import{I as C}from"./flag-icon-DXx8lYRi.js";import{r as se,L as ne,C as ae,e as te,c as re}from"./Collapse-Bs9WwPbt.js";import{L as le,P as ie,M as oe}from"./Popover-CkpF66Jt.js";import{m as T,M as I}from"./LastPage-C21kD8rs.js";import{C as ce}from"./Card-CbN5CsIJ.js";import"./Select-CxNcmE7F.js";import"./users-CX3G6kN4.js";import"./listItemTextClasses-CRmh4-NF.js";function de({emptyRows:s,height:n,sx:x,...l}){return s?e.jsx(b,{sx:{...n&&{height:n*s},...x},...l,children:e.jsx(c,{colSpan:4})}):null}function xe({row:s}){const[n,x]=a.useState(null),[l,g]=a.useState(!1),i=a.useCallback(()=>{x(null)},[]),j=se(s.emplDet);return e.jsxs(e.Fragment,{children:[e.jsxs(b,{hover:!0,tabIndex:-1,children:[e.jsx(c,{sx:{minWidth:38,flexShrink:0,color:"text.disabled",typography:"caption",textAlign:"center"},children:e.jsx(F,{"aria-label":"expand row",size:"small",onClick:()=>g(!l),children:l?e.jsx(C,{width:22,icon:"simple-line-icons:arrow-up"}):e.jsx(C,{width:22,icon:"simple-line-icons:arrow-down"})})}),e.jsx(c,{component:"th",scope:"row",children:e.jsx(d,{gap:2,display:"flex",alignItems:"center",children:G(s.concertDate)})}),e.jsx(c,{children:e.jsx(ne,{primary:s.title,secondary:s.description,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{mt:.5,noWrap:!0,component:"span"},sx:{flex:"1 0 auto"}})}),e.jsx(c,{children:e.jsx(d,{sx:{flexShrink:0,color:"text.disabled",typography:"caption"},children:e.jsx(ee,{color:s.approved&&"success"||"error",children:s.approved?"Утверждено":"Прогноз"})})})]}),e.jsx(b,{sx:{background:"var(--palette-action-hover)"},children:e.jsx(c,{colSpan:4,sx:{padding:`${l?"16px":"0"}`},children:e.jsx(ae,{in:l,children:e.jsxs(d,{children:[s.concertDate.length&&e.jsxs(d,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Даты концертов:"}),e.jsx(h,{variant:"body1",sx:{padding:"0 0 0 120px"},children:Array.isArray(s.concertDate)&&s.concertDate.map(r=>m(r).format("D.MM.YYYY")).join(", ")})]}),s.rehearsalDate.length&&m(s.rehearsalDate[0]).isValid()&&e.jsxs(d,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Даты репетиций:"}),e.jsx(h,{variant:"body1",sx:{padding:"0 0 0 120px"},children:Array.isArray(s.rehearsalDate)&&s.rehearsalDate.map(r=>m(r).format("D.MM.YYYY")).join(", ")})]}),s.comments!=="null"&&e.jsxs(d,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Комментарий:"}),e.jsxs(d,{sx:{padding:"0 0 0 120px"},children:[" ",s.comments.split("///").map((r,u)=>e.jsx(h,{variant:"body1",children:r},u))]})]}),j.length&&e.jsxs(d,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Количество вызовов:"}),e.jsxs(R,{"aria-label":"Занятость",size:"small",sx:{"& th, & td":{background:`${N("var(--palette-info-lighterChannel)",.3)}`}},children:[e.jsx(w,{children:e.jsx(b,{children:j[0].map((r,u)=>e.jsx(c,{children:r},u))})}),e.jsx(A,{children:j.slice(1).map((r,u)=>e.jsxs(b,{children:[e.jsx(c,{component:"th",children:r[0]}),r.slice(1).map((f,P)=>e.jsx(c,{children:f},P))]},u))})]})]}),!(s.details==="null"&&s.notes==="null")&&e.jsxs(d,{sx:{mb:2},children:[e.jsx(h,{variant:"subtitle2",component:"h5",sx:{padding:"0 0 0 30px"},children:"Дополнительные ссылки:"}),e.jsxs(le,{sx:{padding:"0 0 0 120px"},children:[s.details!=="null"&&e.jsx(S,{children:e.jsx(L,{href:s.details,target:"_blank",children:"О концерте"})}),s.notes!=="null"&&e.jsx(S,{children:e.jsx(L,{href:s.notes,target:"_blank",children:"Нотный материал"})})]})]})]})})})}),e.jsx(ie,{open:!!n,anchorEl:n,onClose:i,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(oe,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${T.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${T.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(I,{onClick:i,children:[e.jsx(C,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(I,{onClick:i,sx:{color:"error.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}function pe({headLabel:s}){return e.jsx(w,{children:e.jsxs(b,{children:[e.jsx(c,{}),s.map(n=>e.jsx(c,{align:n.align||"left",sx:{width:n.width,minWidth:n.minWidth},children:n.label},n.id))]})})}m.extend(_);m.extend(Q);function he({formattedData:s}){const n=ge({formattedData:s}),[x,l]=a.useState([]);return a.useEffect(()=>{function g(){if(s.length){const i=re(s);l(i)}}g()},[s]),e.jsxs(q,{children:[e.jsx(d,{display:"flex",alignItems:"center",mb:5,children:e.jsx(h,{variant:"h4",flexGrow:1,children:"Концерты"})}),s.length&&!n.isLoading?e.jsxs(ce,{children:[e.jsx(J,{children:e.jsx(X,{sx:{overflow:"unset"},children:e.jsxs(R,{sx:{minWidth:800},children:[e.jsx(pe,{headLabel:[{id:"date",label:"Дата"},{id:"name",label:"Название"},{id:"status",label:"Статус"}]}),e.jsxs(A,{children:[x.slice(1).slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(g=>e.jsx(xe,{row:g},g.id)),e.jsx(de,{height:92,emptyRows:te(n.page,n.rowsPerPage,x.length-1)})]})]})})}),e.jsx(Z,{component:"div",page:n.page,count:x.length-1,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,rowsPerPageOptions:[5,10,25,50,100],onRowsPerPageChange:n.onChangeRowsPerPage,labelDisplayedRows:n.defaultLabelDisplayedRows,labelRowsPerPage:"Строк на стр.:"})]}):e.jsx(K,{sx:{margin:"50px auto 0",width:"90%"}})]})}function ge({formattedData:s}){const[n,x]=a.useState("name"),[l,g]=a.useState(5),[i,j]=a.useState([]),[r,u]=a.useState("asc"),[f,P]=a.useState(!1),y=s.length-1,v=a.useCallback(()=>{const t=s.map((p,H)=>H?m(p[2][p[2].length-1]):m(0)).slice(1).reverse().findIndex(p=>m().startOf("day")>=p),o=Math.floor((y-(t>=0?t:y))/l);return o>=0?o:0},[s,y,l]),[E,k]=a.useState(v),M=a.useCallback(t=>{u(n===t&&r==="asc"?"desc":"asc"),x(t)},[r,n]),O=a.useCallback((t,o)=>{if(t){j(o);return}j([])},[]),Y=a.useCallback(t=>{const o=i.includes(t)?i.filter(p=>p!==t):[...i,t];j(o)},[i]),$=a.useCallback(()=>{k(0)},[]),B=a.useCallback((t,o)=>{k(o)},[]),D=a.useCallback(()=>{const t=v();k(t)},[v]),W=a.useCallback(({from:t,to:o,count:p})=>p!==-1?`${t}–${o} из ${p}`:"Концертов нет",[]),z=a.useCallback(t=>{g(parseInt(t.target.value,10)),P(!0)},[]);return a.useEffect(()=>{D(),P(!1)},[D,l,f]),{page:E,order:r,onSort:M,orderBy:n,selected:i,rowsPerPage:l,onSelectRow:Y,onResetPage:$,onChangePage:B,onSelectAllRows:O,onChangeRowsPerPage:z,defaultLabelDisplayedRows:W,onSetDefaultPage:D,isLoading:f}}function Le({data:s}){return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs("title",{children:[" ",`Концерты - ${V.appName}`]})}),e.jsx(he,{formattedData:s})]})}export{Le as default};
